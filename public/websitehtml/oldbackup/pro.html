<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Filter logs</title>
    <link rel="icon" href="images/icon.png" type="image/x-icon">
    <link rel="stylesheet" href="style/style3.css">
</head>
    
<body>
    <h1>Filter Logs</h1>
    <label for="keyword">Enter a word or message to filter logs: </label>
    <input type="text" id="keyword">
    <button onclick="filterLogs()">Filter Logs</button>
    <button id="downloadButton" style="display: none;" onclick="downloadLogs()">Download Filtered Logs</button>
    <div id="filteredLogs"></div>

<a id="go-back" href="http://craftchat.duckdns.org:1519/logger" style="position: fixed; right: 10px; top: 20px; color: white; text-decoration: none;">Go back to logger</a>

    <script>
        async function fetchLogs() {
            try {
                const response = await fetch('logs/logs.txt');
                if (response.ok) {
                    return await response.text();
                } else {
                    console.log("Failed to fetch logs. Status code:", response.status);
                    return null;
                }
            } catch (error) {
                console.error("Error fetching logs:", error);
                return null;
            }
        }

        function filterLogs() {
            const keyword = document.getElementById('keyword').value;
            document.getElementById('filteredLogs').innerHTML = '<p>Loading...</p>';
            fetchLogs().then(logs => {
                if (logs) {
                    const filteredLogs = logs.split('\n').filter(log => log.toLowerCase().includes(keyword.toLowerCase()));
                    const filteredLogsCount = filteredLogs.length;
                    const filteredLogsHtml = filteredLogs.join('<br>');
                    const container = document.getElementById('filteredLogs');
                    container.innerHTML = `<p>Found ${filteredLogsCount} matches for "${keyword}":</p><div>${filteredLogsHtml}</div>`;
                    if (filteredLogsCount > 0) {
                        document.getElementById('downloadButton').style.display = 'inline-block';
                        document.getElementById('downloadButton').setAttribute('data-filename', `${keyword}.txt`);
                    } else {
                        document.getElementById('downloadButton').style.display = 'none';
                    }
                }
            });
        }

        function downloadLogs() {
            const keyword = document.getElementById('keyword').value;
            const filteredLogs = document.getElementById('filteredLogs').innerText;
            const blob = new Blob([filteredLogs], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${keyword}.txt`;
            document.body.appendChild(a);
            a.click();
            URL.revokeObjectURL(url);
        }
    </script>
</body>
</html>
